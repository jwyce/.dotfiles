#!/bin/bash

osascript -e "tell application \"System Events\" to tell every desktop to set picture to \"${1}\" as POSIX file"
osascript <<END
tell application "System Events"
    tell application "System Settings"
        activate
    end tell
    delay 0.5
    tell process "System Settings"
        click menu item "Wallpaper" of menu "View" of menu bar 1
        delay 0.2
        click checkbox "Show on all Spaces" of group 2 of scroll area 1 of group 1 of group 2 of splitter group 1 of group 1 of window "Wallpaper"
    end tell
    delay 0.2
    tell application "System Settings"
        quit
    end tell
end tell
END
