#!/usr/bin/env zsh

NEW_PIC="$1"
NUM_DESKTOPS="$2"

if [ -z "$NEW_PIC" ]; then
  echo "Usage: $0 image [desktopCount]"
  exit 1
fi

if [ ! -f "$NEW_PIC" ]; then
    echo "Error: File $NEW_PIC does not exist"
    exit 1
fi

if [ -z "$NUM_DESKTOPS" ]; then
  NUM_DESKTOPS=5
  echo "Defaulted number of desktops to $NUM_DESKTOPS"
fi


SPACE_KEYS=(18 19 20 21 23)

GO_TO_DESKTOP_SCRIPT_FILE=$(mktemp -t desktop-image-switcher-go-to.XXXXXXXX)
GO_TO_DESKTOP_SCRIPT_TEXT="
on run keycode
    tell application \"System Events\"
        key code keycode using {command down}
    end tell
end run"

echo $GO_TO_DESKTOP_SCRIPT_TEXT > $GO_TO_DESKTOP_SCRIPT_FILE

function go_to() {
    echo "keycode $1"
    osascript $GO_TO_DESKTOP_SCRIPT_FILE $1
}

for (( i = 1; i <= $NUM_DESKTOPS; i++ )) do
    ( 
        echo "setting wallpaper $i"
        go_to $SPACE_KEYS[i]
        sleep 0.5
        m wallpaper "$NEW_PIC"
        # xcode installation and license agreement needed
        mint run igorkulman/ChangeMenuBarColor SolidColor "#333333" --all-displays
    )
done
go_to $SPACE_KEYS[1]

rm -f $SCRIPT_FILE
rm -f $GO_TO_DESKTOP_SCRIPT_FILE
