#:schema https://docs.jj-vcs.dev/latest/config-schema.json

[user]
name = "Jared Wyce"
email = "wycejared@gmail.com"

[ui]
editor = "nvim"
diff-editor = ":builtin"
diff-formatter = ":git"
default-command = "log"

[ui.movement]
# Make prev/next default to --edit mode (edit commit in place)
# instead of creating new working copy children
edit = true

[colors]
# do not underline lines in hunks (since 0.19)
"diff removed token" = { underline = false }
"diff added token" = { underline = false }

[git]
sign-on-push = true

# Prevent pushing commits that are work-in-progress
# jj git push will refuse to push these commits and warn you
private-commits = "description(glob:'wip:*') | description(glob:'WIP:*') | description(exact:'')"

[template-aliases]
# Show relative timestamps like "2 hours ago" instead of full dates
'format_timestamp(timestamp)' = 'timestamp.ago()'

# Show just username from email (dillon instead of dillon@example.com)
'format_short_signature(signature)' = 'signature.email().local()'

[fsmonitor]
# Use Watchman for faster working copy snapshots in large repos
# Requires: brew install watchman
backend = "watchman"

[aliases]
bm = ["bookmark"]
gf = ["git", "fetch"]
gp = ["git", "push"]

# Advance a bookmark to your latest pushable change
# Usage: jj tug [bookmark_name]
# - jj tug        → moves closest_bookmark(@) to closest_pushable(@)
# - jj tug main   → moves 'main' to closest_pushable(@)
tug = ["util", "exec", "--", "sh", "-c", """
  if [ -n "$1" ]; then
    jj bookmark move "$1" --to 'closest_pushable(@)'
  else
    jj bookmark move --from 'closest_bookmark(@)' --to 'closest_pushable(@)'
  fi
""", "sh"]

# Show your entire connected stack
stack = ["log", "-r", "stack()"]

[revset-aliases]
# Find commits authored by you
'mine()' = 'author(dmmulroy)'

# Your commits that aren't immutable (trunk/tags/remote branches)
# Shows all your mutable work across the repo
'wip()' = 'mine() ~ immutable()'

# Your commits not yet merged into trunk
# Shows your unmerged/unpushed work
'open()' = 'mine() ~ ::trunk()'

# Find the nearest bookmark in ancestry from a revision
# Used by tug alias to find which bookmark to advance
'closest_bookmark(to)' = 'heads(::to & bookmarks())'

# Find the nearest "pushable" commit - non-empty with a description
# Skips empty WIP commits when advancing bookmarks
'closest_pushable(to)' = 'heads(::to & mutable() & ~description(exact:"") & (~empty() | merges()))'

# Show current branch from @ to its leaf commits
'current()' = '@:: & mutable()'

# Show your entire stack - all mutable commits connected to @
# reachable() finds commits reachable in any direction (ancestors + descendants)
# within the mutable() set (excludes immutable trunk/tags)
'stack()' = 'reachable(@, mutable())'

# Work-specific overrides for repos in ~/Code/work
[[--scope]]
--when.repositories = ["~/dev/work"]

[--scope.user]
email = "j.wyce@fetchrewards.com"
